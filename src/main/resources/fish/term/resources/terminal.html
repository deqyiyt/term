<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW"/>
	<link rel="stylesheet" href="/term/css/bootstrap.min.css">
	<script src="/term/js/jquery-2.1.4.min.js"></script>
	<script src="/term/js/console.js"></script>
	<!--[if lt IE 9]>
	  <script src="/term/js/html5shiv.min.js"></script>
	  <script src="/term/js/respond.min.js"></script>
	<![endif]-->
	<title>控制终端</title>
	<style type="text/css">
		body {
			overflow-y: hidden;
		}
	</style>
	<script type="text/javascript">
	document.onkeydown = function (e) {
	    var ev = window.event || e;
	    var code = ev.keyCode || ev.which;
	    if (code == 116) {
	        if(ev.preventDefault) {
	            ev.preventDefault();
	        } else {
	            ev.keyCode = 0;
	            ev.returnValue = false;
	        }
	    }
	}
	</script>
</head>
<body>
	<div class="panel panel-success">
		<div class="panel-body" style="color: red;background: black;padding: 0;overflow: hidden">
			<div id="term"></div>
			<div class="btn-panel" style="alert alert-success">
				<textarea class="form-control" id="cmd" style="background:#FFFF99;resize:none;border-radius: 0;"></textarea>
				<span class="pull-left" style="margin-top: 6px">带中文命令请在上面输入↑↑↑&nbsp;</span>
				<button type="button" style="border-radius: 0;" class="btn btn-danger pull-right btn-stop">断开连接</button>
				<button type="button" style="border-radius: 0;" class="btn btn-success pull-right btn-send">发送命令</button>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
	$('.btn-send').click(function(){
		$cmd = $('#cmd').val();
		webSocket.send($cmd);
		$('#cmd').val("");
	})
	
	$('.btn-stop').click(function(){
		webSocket.send("exit");
		term.write("\nConnection closed.");
	})
	
	var wsPath = "";
	if (window.location.protocol === 'http:') {
		wsPath = 'ws://' + window.location.host;
    } else {
    	wsPath = 'wss://' + window.location.host;
    }

	var webSocket = new WebSocket(wsPath + "/term/terminal/${id}");
	
	webSocket.onerror = function(event) {
		term.write("\nConnection closed.");
	};
	
	webSocket.onopen = function(event) {
		
	};
	
	webSocket.onmessage = function(event) {
		term.write(event.data);
	};
	
	webSocket.onclose = function(event) {
		term.write("\nConnection closed.");
	};
	
	var width = $('#term').width();
	var height = $(window).height() - 65;
	var term = new Terminal({
	    cols: Math.floor(width / 7.25),
	    rows: Math.floor(height / 18),
	    screenKeys: false,
        useStyle: true,
        cursorBlink: true,
        convertEol: true
	});
	term.open($("#term").empty()[0]);
	term.on('data', function(data) {
		webSocket.send(data);
	});
	
	$(window).resize(function() {
		var width = $('#term').width();
		var height = $(window).height() - 65;
		term.resize(Math.floor(width / 7.25), Math.floor(height / 18));
	});
	
</script>
</html>